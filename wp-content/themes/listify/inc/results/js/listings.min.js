window.wp=window.wp||{},function(a,b){a.wp=a.wp||{};var c=a.document,d=a.jQuery,e=wp.listifyResults||{};e.DataServices=[],e.DataService=e.Class.extend({response:null,activeResponse:d.Deferred(),resultTemplate:wp.template("listingCard"),noResultsTemplate:wp.template("noResults"),resultsContainer:"ul.job_listings",columns:e.settings.displayColumns,initialize:function(a){d.extend(this,a||{})},update:function(){},getDefaultCoordinates:function(){},addResults:function(b){a.console&&e.settings.scriptDebug&&console.log("Adding results...");var c=this,f=this.resultsContainer;_.isUndefined(b)||_.isUndefined(b.resultsContainer)||(this.resultsContainer=b.resultsContainer),this.resetResults();var g=d(this.resultsContainer);0!==g.length&&(_.isUndefined(b)||_.isUndefined(b.columns)||(this.columns=b.columns),g.data("card-columns",this.columns),g.attr("data-card-columns",this.columns),_.isUndefined(e.controllers.dataService.response.listings)||0===e.controllers.dataService.response.listings.length||(g.html("").addClass("listing-cards-anchor--active"),_.each(e.controllers.dataService.response.listings,function(a){g.append(c.resultTemplate(a))})),this.resultsContainer=f)},resetResults:function(){this.setFound(),d(this.resultsContainer).removeClass("listing-cards-anchor--active").html(this.noResultsTemplate({noResults:e.settings.i18n.noResults}))},setFound:function(){}}),e.DataServices.WPJobManager=e.DataService.extend({isAddressGeocoded:!1,prevAddress:d("#search_location").val(),$target:d("div.job_listings"),$form:d("form.job_filters"),$address:d('[name="search_location"]'),$lat:d("#search_lat"),$region:d("#search_region"),$lng:d("#search_lng"),$radius:d("#search_radius"),$searchThisLocation:d("#search_this_location"),autoComplete:"search_location",initialize:function(b){if(e.DataService.prototype.initialize.call(b),this.resultsContainer=this.$target.children("ul.job_listings"),this.$form.on("submit",function(a){a.preventDefault()}),this.radiusSlider(),this.locateMe(),0!==this.$target.length){var f=this;this.$target.on("updated_results",function(b,g){f.response=g,"resolved"!==f.activeResponse.state()&&(a.console&&e.settings.scriptDebug&&console.log("Data Service ready..."),f.activeResponse.resolve()),d(c).trigger("listifyDataServiceLoaded")}),this.$target.on("reset",function(a){void 0!==this.$radius&&this.$radius.val(e.settings.dataService.wpjobmanager.searchRadiusDefault),void 0!==this.$lat&&this.$lat.val(""),void 0!==this.$lng&&this.$lng.val(""),void 0!==this.$region&&this.$region.val("")}),this.$target.on("update_results",function(a){f.maybeReverseGeocode()})}},update:function(){this.$target.triggerHandler("update_results",[1,!1])},maybeReverseGeocode:function(){if(e.controllers.mapService&&e.controllers.mapService.geocode){if(""===this.$address.val())return void(""===this.$searchThisLocation.val()&&(this.$radius.val(e.settings.dataService.wpjobmanager.searchRadiusDefault),this.$lat.val(""),this.$lng.val("")));this.$address.val()!=this.prevAddress&&(this.isAddressGeocoded=!1),this.isAddressGeocoded||this.isAddressGeocoding||e.controllers.mapService.geocode(this.$address.val())}},getDefaultCoordinates:function(){return this.$lat.val()&&"0"!=this.$lat.val()?{lat:this.$lat.val(),lng:this.$lng.val()}:{lat:e.settings.mapService.center[0],lng:e.settings.mapService.center[1]}},radiusSearch:function(a,b){this.$lat.val(a),this.$lng.val(b),this.update()},radiusSlider:function(){var a=this;d(".search-radius-slider div").each(function(b){var c=noUiSlider.create(this,{format:wNumb({decimals:0}),step:1,start:[e.settings.dataService.wpjobmanager.searchRadiusDefault],range:{min:parseInt(e.settings.dataService.wpjobmanager.searchRadiusMin),max:parseInt(e.settings.dataService.wpjobmanager.searchRadiusMax)}});c.on("set",a.updateRadius),c.on("set",function(){a.update()})})},updateRadius:function(a,b){d(".radi").text(a[0]),d("#search_radius").val(a[0])},locateMe:function(){if(navigator.geolocation&&e.settings.isSSL){var a=this;d(c).ready(function(){!_.isUndefined(e.controllers.mapService)&&e.controllers.mapService.geocode&&(d(".search_location").append('<i class="locate-me"></i>'),d(".locate-me").on("click",function(b){b.preventDefault(),d(this).addClass("loading"),navigator.geolocation.getCurrentPosition(a.locateMeSuccess.bind(a),null,{enableHighAccuracy:!0})}))})}},locateMeSuccess:function(a){var b=a.coords.latitude,c=a.coords.longitude;!_.isUndefined(e.controllers.mapService)&&e.controllers.mapService.geocode&&(e.controllers.mapService.geocode(b+", "+c),d(".locate-me").removeClass("loading"))},searchThisLocation:function(){var a=e.controllers.mapService.getCenterLat(),b=e.controllers.mapService.getCenterLng(),c=e.controllers.mapService.getRadius();this.$lat.val(a),this.$lng.val(b),this.$radius.val(c),this.$searchThisLocation.val("1"),this.update(),this.$searchThisLocation.val("")},setFound:function(){var a=_.isUndefined(e.controllers.dataService.response.found_posts)?0:e.controllers.dataService.response.found_posts,b=_.isUndefined(e.controllers.dataService.response.offset)?"":" "+e.controllers.dataService.response.offset;d(".results-found").html(e.settings.i18n.resultsFound.replace("%d",a)+b)}}),e.DataServices.FacetWP=e.DataService.extend({resultsContainer:".facetwp_job_listings ul.job_listings",initialize:function(b){e.DataService.prototype.initialize.call(b);var f=this;d(c).on("facetwp-loaded",function(b,g){_.isUndefined(FWP.settings.listify)||(f.response=FWP.settings.listify,"resolved"!==f.activeResponse.state()?(a.console&&e.settings.scriptDebug&&console.log("Data Service ready..."),f.activeResponse.resolve()):_.isUndefined(e.controllers.mapService)||e.controllers.mapService.addMarkers(f.response.listings),d(c).trigger("listifyDataServiceLoaded"))})},getDefaultCoordinates:function(){var a=e.settings.mapService.center[0],b=e.settings.mapService.center[1];if(d(".facetwp-type-proximity").length>0){var c=d(".facetwp-type-proximity").data("name");FWP.facets[c].length&&(a=FWP.facets[c][0],b=FWP.facets[c][1])}return{lat:a,lng:b}},searchThisLocation:function(){var a=e.controllers.mapService.getCenterLat(),b=e.controllers.mapService.getCenterLng(),c=e.controllers.mapService.getRadius();d("#facetwp-radius").append(d("<option>",{value:c,text:c})),d("#facetwp-radius").val(c),d(".facetwp-lat").attr("value",a),d(".facetwp-lng").attr("value",b),FWP.refresh()}}),"facetwp"==e.settings.dataService.service?e.controllers.dataService=new e.DataServices.FacetWP:e.controllers.dataService=new e.DataServices.WPJobManager,d(c).on("listifyDataServiceLoaded",function(){e.controllers.dataService.addResults()}),d("#search-this-location").click(function(a){a.preventDefault(),e.controllers.dataService.searchThisLocation()})}(window);